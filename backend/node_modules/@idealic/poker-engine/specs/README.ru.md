# Руководство по интеграции Poker Engine

Этот документ содержит руководство по интеграции Poker Engine в ваши серверные и клиентские приложения. Он объясняет основные концепции, архитектуру системы и жизненный цикл игры в Poker Engine.

## Основные концепции

### Рука как нотация

Poker Engine использует стандартизированную нотацию для покерных игр, называемую **Hand** (рука), как единственный источник правды. Рука похожа на шахматную нотацию: она хранит действия игроков, а не текущее положение всех фигур. Это делает её мощным форматом как для хранения, так и для передачи данных, поскольку она позволяет передавать всё состояние игры без необходимости управлять деталями.

У руки есть **автор**, который определяет, чьё видение игры она представляет. Это важно для игр с неполной информацией, так как у каждого игрока своя рука, даже если игра одна и та же. Например, каждый игрок будет иметь свою руку с собственными закрытыми картами, а сервер будет иметь полную руку со всеми картами.

Преимущества такого подхода:

- **Портативность:** Нотация руки — человекочитаемый и переносимый формат, который легко хранить, передавать и воспроизводить.
- **Детерминизм:** Состояние покерной партии можно точно восстановить, воспроизведя действия из руки. Это облегчает отладку и тестирование приложений.
- **Гибкость:** Нотация руки подходит для описания множества разновидностей покера и игровых форматов.

Каждая рука — полностью самодостаточная версия игры, достаточная для её восстановления с точки зрения игрока. Поэтому она так удобна как для хранения, так и для передачи состояния.

### Игра как видение стола

Poker Engine предоставляет полное и детализированное представление состояния стола. Объект **Game** содержит всю информацию, необходимую для отображения игры:

- Игроки за столом и их текущий статус (размер стека, статус действия)
- Общие карты на борде
- Размер банка
- Текущий раунд торговли
- Следующий игрок, который должен действовать
- Состояние ставок
- Статус завершения игры
- Доступные игроку действия (какие кнопки активны)
- Время, оставшееся для действия
- Выигрыши и проигрыши каждого игрока
- Расчёт рейка

Отдельно внутри объекта Game хранятся **статистические данные** для расширенной аналитики.

Это комплексное состояние игры упрощает создание пользовательских интерфейсов, точно отражающих реальную ситуацию.

## Архитектура системы

### Модель клиент–сервер

Poker Engine работает как на клиенте, так и на сервере. Хотя обязанности различаются, общий движок позволяет обеим сторонам независимо продвигать игру.

**Задачи клиента:**

- **Активация действий:** Определять, какие действия доступны игроку (например, кнопка ставки).
- **Оптимистичный рендеринг:** Благодаря движку на клиенте можно реализовать оптимистичное обновление состояния, когда игра продвигается без ожидания подтверждения от сервера, что улучшает плавность интерфейса.

**Задачи сервера:**

- **Проверка действий:** Сервер — окончательный арбитр корректности действий.
- **Санитизация руки:** Сервер подготавливает отдельную версию руки для каждого игрока.
- **Случайность:** Сервер отвечает за случайные процессы (перетасовка колоды, раздача карт).

### Архитектура с одной конечной точкой

Весь игровой процесс обрабатывается одним серверным эндпоинтом (например, `/game/poker`). Этот эндпоинт принимает состояние от клиента, продвигает игру и при необходимости запускает новую партию.

Бэкенд — это обычный статeless API, работающий в формате запрос–ответ, без длительных процессов.

### Модульный бэкенд

Серверный эндпоинт для покера используется и другими играми. Модульная структура позволяет подключать и отключать Poker Engine, обеспечивая переиспользование сетевого и игрового кода.

### Лобби и система столов

Poker Engine отвечает только за логику одной руки покера. Опыт игрока — поиск игр, посадка за стол, ожидание начала партии и переход между играми — обрабатывается отдельной **системой столов** на сервере, которая используется и для других карточных игр.

Система столов отвечает за:

- Назначение стеков игрокам
- Возврат стеков
- Выплату выигрышей при выходе игрока

Также сервер обрабатывает тайм-ауты, что не входит в задачи Poker Engine.

